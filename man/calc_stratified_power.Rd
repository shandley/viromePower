% Generated by roxygen2: do not edit by hand
\name{calc_stratified_power}
\alias{calc_stratified_power}
\title{Calculate Power for Stratified Virome Studies}
\usage{
calc_stratified_power(
  strata_sizes, 
  effect_sizes,
  strata_weights = NULL,
  n_viruses,
  clustering_factor = 0,
  stratification_vars = "host_factors",
  allocation_method = "proportional",
  alpha = 0.05, 
  sparsity = 0.8, 
  dispersion = 2,
  method = "stratified_test", 
  design_effect = NULL,
  n_sim = 100
)
}
\arguments{
  \item{strata_sizes}{Vector of sample sizes for each stratum per group}
  \item{effect_sizes}{Effect size (fold change) per stratum or single value for all strata}
  \item{strata_weights}{Importance/weighting of each stratum (must sum to 1)}
  \item{n_viruses}{Number of viral taxa tested}
  \item{clustering_factor}{Intra-class correlation coefficient for clustered designs (0-1)}
  \item{stratification_vars}{Character describing the stratification basis (informational only)}
  \item{allocation_method}{Method for sample allocation: "proportional", "optimal", or "equal"}
  \item{alpha}{Significance level (default: 0.05)}
  \item{sparsity}{Proportion of zeros in the data, can be vector by stratum (default: 0.8)}
  \item{dispersion}{Dispersion parameter for viral abundance, can be vector by stratum (default: 2)}
  \item{method}{Test method to use: "stratified_test", "mixed_effects", or "survey_adjusted" (default: "stratified_test")}
  \item{design_effect}{Adjustment for complex survey design, if known (default: NULL for calculation)}
  \item{n_sim}{Number of simulations for Monte Carlo estimation (default: 100)}
}
\value{
A list containing:
\itemize{
  \item{overall_power}{Overall statistical power of the stratified design}
  \item{stratum_specific_power}{Power estimates for each stratum}
  \item{effective_sample_size}{Sample size adjusted for design effect}
  \item{design_effect_actual}{Calculated design effect}
  \item{fdr}{False discovery rate}
  \item{avg_detected}{Average number of differentially abundant taxa detected}
  \item{sim_summary}{Detailed simulation results}
  \item{parameters}{List of input parameters used for the calculation}
}
}
\description{
Calculates statistical power for detecting differences in viral taxa between groups
in a stratified virome study design, accounting for multiple testing correction, 
stratification factors, and complex sampling designs.
}
\examples{
# Simple stratification with two strata of different sizes
power_result <- calc_stratified_power(
  strata_sizes = c(10, 20),
  effect_sizes = 2.5,
  strata_weights = c(0.4, 0.6),
  n_viruses = 30,
  clustering_factor = 0.1,
  stratification_vars = "host_factors",
  allocation_method = "proportional"
)

# Example with higher statistical power
power_result <- calc_stratified_power(
  strata_sizes = c(15, 20),
  effect_sizes = c(3.0, 3.5),
  strata_weights = c(0.4, 0.6),
  n_viruses = 20,
  clustering_factor = 0.05,
  sparsity = 0.6,
  dispersion = 1.5,
  stratification_vars = "geography",
  method = "mixed_effects"
)

# Stratification with three strata and different effect sizes
power_result <- calc_stratified_power(
  strata_sizes = c(15, 15, 15),
  effect_sizes = c(2.5, 3.0, 3.5),
  strata_weights = c(0.3, 0.3, 0.4),
  n_viruses = 30,
  clustering_factor = 0.1,
  sparsity = 0.7,
  stratification_vars = "geography",
  allocation_method = "equal",
  method = "mixed_effects"
)
}